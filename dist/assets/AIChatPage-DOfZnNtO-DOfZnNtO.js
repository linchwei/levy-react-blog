import{j as e,m as O}from"./ui-8Or-2zOT-8Or-2zOT.js";import{r as s}from"./vendor-QyoG3HE1-QyoG3HE1.js";import{e as L,B as z,c as n}from"./index-CB-nuzdG-CB-nuzdG.js";import{S as Y}from"./scroll-area-DHVx11Cp-DHVx11Cp.js";import{c as B}from"./aiService-BKnG4cQx-BKnG4cQx.js";import{X as G,S as F,N as J,b as V}from"./Navigation-CVIh0ny8-CVIh0ny8.js";import{F as X}from"./Footer-HVOx1zD2-HVOx1zD2.js";import{P as Q}from"./plus-BdVoi9Co-BdVoi9Co.js";import{C as W}from"./check-C6OzHscG-C6OzHscG.js";import{T as Z}from"./trash-2-BlOGfJ7l-BlOGfJ7l.js";import{C as ee}from"./ChatMessage-CuZvsdRf-CuZvsdRf.js";import{S as te}from"./send-BGQ-kLuR-BGQ-kLuR.js";import{C as se}from"./code-BoR7a5mS-BoR7a5mS.js";import{L as ae}from"./lightbulb-Chg089RR-Chg089RR.js";import"./animation-Cg-7L8ts-Cg-7L8ts.js";import"./index-BdQq_4o_-BdQq_4o_.js";import"./input-BH5s_kIV-BH5s_kIV.js";import"./middleware-BIVXqGDk-BIVXqGDk.js";import"./copy-C6yuB-dr-C6yuB-dr.js";import"./extends-CF3RwP-h-CF3RwP-h.js";import"./user-BXf8mkqE-BXf8mkqE.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]],$=L("message-square",ne);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]],ie=L("pen",re);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],le=L("square",oe);function K({sessions:r,currentSessionId:u,onNewChat:l,onSelectSession:x,onDeleteSession:m,onRenameSession:y,isDark:g,isOpen:j,onClose:v}){const[C,N]=s.useState(null),[c,p]=s.useState(""),E=s.useCallback(i=>{N(i.id),p(i.title)},[]),M=s.useCallback(i=>{c.trim()&&y(i,c.trim()),N(null),p("")},[c,y]),A=s.useCallback(()=>{N(null),p("")},[]),R=i=>{const d=new Date(i),S=new Date,_=d.toDateString()===S.toDateString(),t=new Date(S.setDate(S.getDate()-1)).toDateString()===d.toDateString();return _?d.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"}):t?"昨天":d.toLocaleDateString("zh-CN",{month:"short",day:"numeric"})};return e.jsxs(e.Fragment,{children:[j&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-40 lg:hidden",onClick:v}),e.jsxs("div",{className:n("fixed lg:static inset-y-0 left-0 z-50 w-72 flex flex-col h-full",g?"bg-zinc-950 border-r border-zinc-800":"bg-gray-50 border-r border-gray-200",j?"translate-x-0":"-translate-x-full lg:translate-x-0"),children:[e.jsx("div",{className:n("p-4 border-b",g?"border-zinc-800":"border-gray-200"),children:e.jsxs(z,{onClick:l,className:"w-full justify-start gap-2 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700",children:[e.jsx(Q,{className:"w-4 h-4"}),"新建对话"]})}),e.jsx(Y,{className:"flex-1",children:e.jsx("div",{className:"p-2 space-y-1",children:r.length===0?e.jsx("div",{className:n("text-center py-8 text-sm",g?"text-zinc-500":"text-gray-400"),children:"暂无对话记录"}):r.map(i=>e.jsxs("div",{className:n("group flex items-center gap-2 p-2 rounded-lg cursor-pointer transition-colors",u===i.id?g?"bg-zinc-800":"bg-white shadow-sm":g?"hover:bg-zinc-900":"hover:bg-gray-100"),onClick:()=>x(i.id),children:[e.jsx($,{className:n("w-4 h-4 flex-shrink-0",g?"text-zinc-400":"text-gray-500")}),C===i.id?e.jsxs("div",{className:"flex-1 flex items-center gap-1",children:[e.jsx("input",{type:"text",value:c,onChange:d=>p(d.target.value),onKeyDown:d=>{d.key==="Enter"&&M(i.id),d.key==="Escape"&&A()},onClick:d=>d.stopPropagation(),autoFocus:!0,className:n("flex-1 px-2 py-1 text-sm rounded border outline-none",g?"bg-zinc-900 border-zinc-700 text-zinc-100":"bg-white border-gray-300 text-gray-900")}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:d=>{d.stopPropagation(),M(i.id)},children:e.jsx(W,{className:"w-3 h-3 text-green-500"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:d=>{d.stopPropagation(),A()},children:e.jsx(G,{className:"w-3 h-3 text-red-500"})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:n("text-sm truncate",g?"text-zinc-200":"text-gray-700"),children:i.title}),e.jsx("p",{className:n("text-xs",g?"text-zinc-500":"text-gray-400"),children:R(i.updatedAt)})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx(z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:d=>{d.stopPropagation(),E(i)},children:e.jsx(ie,{className:"w-3 h-3"})}),e.jsx(z,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:d=>{d.stopPropagation(),m(i.id)},children:e.jsx(Z,{className:"w-3 h-3 text-red-500"})})]})]})]},i.id))})}),e.jsx("div",{className:n("p-4 border-t",g?"border-zinc-800":"border-gray-200"),children:e.jsx("p",{className:n("text-xs text-center",g?"text-zinc-500":"text-gray-400"),children:"使用网站主题设置"})})]})]})}function ce({onSend:r,isLoading:u,isDark:l,onStop:x,placeholder:m="输入消息..."}){const[y,g]=s.useState(""),j=s.useRef(null),v=s.useCallback(()=>{const c=y.trim();!c||u||(r(c),g(""),j.current&&(j.current.style.height="auto"))},[y,u,r]),C=s.useCallback(c=>{c.key==="Enter"&&!c.shiftKey&&(c.preventDefault(),v())},[v]),N=s.useCallback(()=>{const c=j.current;c&&(c.style.height="auto",c.style.height=`${Math.min(c.scrollHeight,200)}px`)},[]);return e.jsx("div",{className:n("border-t px-4 py-4",l?"border-zinc-800 bg-zinc-950":"border-gray-200 bg-white"),children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:n("relative flex items-end gap-2 rounded-xl border p-3 transition-all",l?"border-zinc-700 bg-zinc-900 focus-within:border-zinc-600":"border-gray-300 bg-white focus-within:border-gray-400"),children:[e.jsx("textarea",{ref:j,value:y,onChange:c=>g(c.target.value),onKeyDown:C,onInput:N,placeholder:m,rows:1,className:n("flex-1 resize-none bg-transparent outline-none max-h-[200px] min-h-[24px]",l?"text-zinc-100 placeholder:text-zinc-500":"text-gray-900 placeholder:text-gray-400"),disabled:u}),u?e.jsx(z,{variant:"destructive",size:"icon",onClick:x,className:"flex-shrink-0 h-8 w-8",children:e.jsx(le,{className:"w-4 h-4"})}):e.jsx(z,{variant:"default",size:"icon",onClick:v,disabled:!y.trim(),className:n("flex-shrink-0 h-8 w-8 transition-all",y.trim()?"bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700":"opacity-50 cursor-not-allowed"),children:e.jsx(te,{className:"w-4 h-4"})})]}),e.jsx("p",{className:n("text-xs mt-2 text-center",l?"text-zinc-500":"text-gray-400"),children:"Enter 发送，Shift + Enter 换行"})]})})}const de=[{icon:$,title:"解释一下",description:"React 的 useEffect 是如何工作的？",prompt:"请详细解释 React 的 useEffect Hook 的工作原理，包括依赖数组、清理函数等。"},{icon:se,title:"帮我写代码",description:"用 TypeScript 实现一个防抖函数",prompt:"请用 TypeScript 实现一个防抖（debounce）函数，包括类型定义和使用示例。"},{icon:ae,title:"给我建议",description:"如何优化前端性能？",prompt:"请给出前端性能优化的建议，包括加载优化、渲染优化、代码优化等方面。"},{icon:F,title:"创意写作",description:"帮我写一篇技术博客的开头",prompt:"请帮我写一篇关于前端开发的技术博客开头段落，要求引人入胜。"}];function me({isDark:r,onSuggestionClick:u}){return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full px-4 py-12",children:[e.jsxs(O.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center mb-12",children:[e.jsx("div",{className:n("w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4","bg-gradient-to-br from-blue-500 to-purple-600"),children:e.jsx(F,{className:"w-8 h-8 text-white"})}),e.jsx("h1",{className:n("text-2xl font-bold mb-2",r?"text-zinc-100":"text-gray-900"),children:"AI 助手"}),e.jsx("p",{className:n("text-sm max-w-md",r?"text-zinc-400":"text-gray-500"),children:"我可以帮你解答技术问题、编写代码、提供建议，或者只是聊聊天。"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 w-full max-w-2xl",children:de.map((l,x)=>e.jsxs(O.button,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:x*.1},onClick:()=>u==null?void 0:u(l.prompt),className:n("flex items-start gap-3 p-4 rounded-xl text-left transition-all","border hover:shadow-md",r?"bg-zinc-900/50 border-zinc-800 hover:border-zinc-700 hover:bg-zinc-900":"bg-white border-gray-200 hover:border-gray-300 hover:bg-gray-50"),children:[e.jsx("div",{className:n("w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0",r?"bg-zinc-800":"bg-gray-100"),children:e.jsx(l.icon,{className:n("w-4 h-4",r?"text-zinc-400":"text-gray-500")})}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:n("font-medium text-sm mb-0.5",r?"text-zinc-200":"text-gray-700"),children:l.title}),e.jsx("p",{className:n("text-xs truncate",r?"text-zinc-500":"text-gray-400"),children:l.description})]})]},l.title))}),e.jsx(O.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:n("mt-12 text-xs text-center",r?"text-zinc-500":"text-gray-400"),children:e.jsx("p",{children:"提示：支持 Markdown 格式，代码块可复制"})})]})}const q="ai-chat-sessions",H="ai-chat-current-session";function D(){return Math.random().toString(36).substring(2,15)}function U(r){const u=r.trim();return u.length<=20?u:u.substring(0,20)+"..."}function Te(){const[r,u]=s.useState(!0),[l,x]=s.useState(()=>{if(typeof window>"u")return[];const t=localStorage.getItem(q);return t?JSON.parse(t):[]}),[m,y]=s.useState(()=>typeof window>"u"?null:localStorage.getItem(H)),[g,j]=s.useState(!1),[v,C]=s.useState(!1),N=s.useRef(null),c=s.useRef(null);s.useEffect(()=>{const t=()=>{u(document.documentElement.classList.contains("dark"))};t();const a=new MutationObserver(t);return a.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),()=>a.disconnect()},[]);const p=l.find(t=>t.id===m),E=(p==null?void 0:p.messages)||[];s.useEffect(()=>{localStorage.setItem(q,JSON.stringify(l))},[l]),s.useEffect(()=>{m&&localStorage.setItem(H,m)},[m]),s.useEffect(()=>{var t;(t=c.current)==null||t.scrollIntoView({behavior:"smooth"})},[E]);const M=s.useCallback(()=>{const t={id:D(),title:"新对话",messages:[],createdAt:Date.now(),updatedAt:Date.now()};x(a=>[t,...a]),y(t.id),j(!1)},[]),A=s.useCallback(t=>{y(t),j(!1)},[]),R=s.useCallback(t=>{x(a=>a.filter(w=>w.id!==t)),m===t&&y(null)},[m]),i=s.useCallback((t,a)=>{x(w=>w.map(f=>f.id===t?{...f,title:a,updatedAt:Date.now()}:f))},[]),d=s.useCallback(()=>{var t;(t=N.current)==null||t.abort(),N.current=null,C(!1),x(a=>a.map(w=>w.id===m?{...w,messages:w.messages.map(f=>f.isStreaming?{...f,isStreaming:!1}:f)}:w))},[m]),S=s.useCallback(async t=>{if(!t.trim()||v)return;let a=m;if(a){const h=l.find(o=>o.id===a);h&&h.messages.length===0&&i(a,U(t))}else{const h={id:D(),title:U(t),messages:[],createdAt:Date.now(),updatedAt:Date.now()};x(o=>[h,...o]),a=h.id,y(h.id)}const w={id:D(),role:"user",content:t.trim(),timestamp:Date.now()};x(h=>h.map(o=>o.id===a?{...o,messages:[...o.messages,w],updatedAt:Date.now()}:o));const f=D(),k={id:f,role:"assistant",content:"",timestamp:Date.now(),isStreaming:!0};x(h=>h.map(o=>o.id===a?{...o,messages:[...o.messages,k],updatedAt:Date.now()}:o)),C(!0);try{const h=l.find(b=>b.id===a),o=h?h.messages.slice(-10).map(b=>({role:b.role,content:b.content})):[];N.current=new AbortController,await B({messages:[...o,{role:"user",content:t.trim()}],temperature:.7,maxTokens:2e3,onStream:b=>{x(I=>I.map(T=>T.id===a?{...T,messages:T.messages.map(P=>P.id===f?{...P,content:P.content+b}:P)}:T))}})}catch(h){console.error("Chat error:",h),x(o=>o.map(b=>b.id===a?{...b,messages:b.messages.map(I=>I.id===f?{...I,content:I.content+`

[错误: 发送消息失败，请检查 API 配置或稍后重试]`,isStreaming:!1}:I)}:b))}finally{C(!1),N.current=null,x(h=>h.map(o=>o.id===a?{...o,messages:o.messages.map(b=>b.id===f?{...b,isStreaming:!1}:b)}:o))}},[m,v,l,i]),_=s.useCallback(async()=>{if(!p)return;const t=[...p.messages].reverse().findIndex(f=>f.role==="user");if(t===-1)return;const a=p.messages.length-1-t,w=p.messages[a];x(f=>f.map(k=>k.id===m?{...k,messages:k.messages.slice(0,a+1),updatedAt:Date.now()}:k)),await S(w.content)},[p,m,S]);return e.jsxs("div",{className:"min-h-screen bg-background flex flex-col",children:[e.jsx(J,{}),e.jsxs("main",{className:"flex-1 flex pt-16",children:[e.jsx("div",{className:"hidden lg:block w-72 flex-shrink-0",children:e.jsx("div",{className:"sticky top-16 h-[calc(100vh-4rem)]",children:e.jsx(K,{sessions:l,currentSessionId:m,onNewChat:M,onSelectSession:A,onDeleteSession:R,onRenameSession:i,isDark:r,isOpen:!1,onClose:()=>{}})})}),e.jsx("div",{className:"lg:hidden",children:e.jsx(K,{sessions:l,currentSessionId:m,onNewChat:M,onSelectSession:A,onDeleteSession:R,onRenameSession:i,isDark:r,isOpen:g,onClose:()=>j(!1)})}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0",children:[e.jsxs("header",{className:n("flex items-center justify-between px-4 py-3 border-b lg:hidden",r?"border-zinc-800 bg-zinc-950":"border-gray-200 bg-white"),children:[e.jsx(z,{variant:"ghost",size:"icon",onClick:()=>j(!0),className:r?"text-zinc-400":"text-gray-600",children:e.jsx(V,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5 text-purple-500"}),e.jsx("h1",{className:n("font-semibold",r?"text-zinc-100":"text-gray-900"),children:(p==null?void 0:p.title)||"AI 助手"})]}),e.jsx("div",{className:"w-10"})]}),e.jsx(Y,{className:"flex-1",children:E.length===0?e.jsx(me,{isDark:r,onSuggestionClick:S}):e.jsxs("div",{className:"pb-4",children:[E.map((t,a)=>e.jsx(ee,{message:t,isDark:r,onRegenerate:a===E.length-1&&t.role==="assistant"?_:void 0,isLastMessage:a===E.length-1},t.id)),e.jsx("div",{ref:c})]})}),e.jsx(ce,{onSend:S,isLoading:v,isDark:r,onStop:d,placeholder:"输入消息..."})]})]}),e.jsx(X,{})]})}export{Te as AIChatPage};
//# sourceMappingURL=AIChatPage-DOfZnNtO-DOfZnNtO.js.map
