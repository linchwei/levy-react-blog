{"version":3,"file":"todoStore-BnE6FlyY-BnE6FlyY.js","sources":["../../src/stores/todoStore.ts"],"sourcesContent":["import { create } from 'zustand'\nimport { persist } from 'zustand/middleware'\nimport type {\n  Todo,\n  Priority,\n  FilterType,\n  TodoStats,\n  TodoFormData,\n} from '@/types'\nimport { TODO_STORAGE_KEY, PRIORITY_CONFIG } from '@/constants'\n\n// ============================================\n// Store 状态类型\n// ============================================\ninterface TodoState {\n  todos: Todo[]\n  filter: FilterType\n}\n\n// ============================================\n// Store Actions 类型\n// ============================================\ninterface TodoActions {\n  addTodo: (data: TodoFormData) => void\n  deleteTodo: (id: string) => void\n  toggleTodo: (id: string) => void\n  updateTodo: (\n    id: string,\n    updates: Partial<Omit<Todo, 'id' | 'createdAt'>>\n  ) => void\n  setFilter: (filter: FilterType) => void\n  reorderTodos: (oldIndex: number, newIndex: number) => void\n  clearCompleted: () => void\n}\n\n// ============================================\n// 派生状态计算函数\n// ============================================\nconst calculateStats = (todos: Todo[]): TodoStats => ({\n  total: todos.length,\n  completed: todos.filter(todo => todo.completed).length,\n  active: todos.filter(todo => !todo.completed).length,\n})\n\nconst filterTodos = (todos: Todo[], filter: FilterType): Todo[] => {\n  switch (filter) {\n    case 'active':\n      return todos.filter(todo => !todo.completed)\n    case 'completed':\n      return todos.filter(todo => todo.completed)\n    default:\n      return todos\n  }\n}\n\n// ============================================\n// 创建 Todo Store\n// ============================================\nexport const useTodoStore = create<TodoState & TodoActions>()(\n  persist(\n    set => ({\n      todos: [],\n      filter: 'all',\n\n      addTodo: data => {\n        const now = new Date()\n        const newTodo: Todo = {\n          id: crypto.randomUUID(),\n          title: data.title,\n          description: data.description || '',\n          priority: data.priority,\n          completed: false,\n          createdAt: now,\n          updatedAt: now,\n        }\n        set(state => ({\n          todos: [newTodo, ...state.todos],\n        }))\n      },\n\n      deleteTodo: id => {\n        set(state => ({\n          todos: state.todos.filter(todo => todo.id !== id),\n        }))\n      },\n\n      toggleTodo: id => {\n        set(state => ({\n          todos: state.todos.map(todo =>\n            todo.id === id\n              ? { ...todo, completed: !todo.completed, updatedAt: new Date() }\n              : todo\n          ),\n        }))\n      },\n\n      updateTodo: (id, updates) => {\n        set(state => ({\n          todos: state.todos.map(todo =>\n            todo.id === id\n              ? { ...todo, ...updates, updatedAt: new Date() }\n              : todo\n          ),\n        }))\n      },\n\n      setFilter: filter => {\n        set({ filter })\n      },\n\n      reorderTodos: (oldIndex, newIndex) => {\n        set(state => {\n          const newTodos = [...state.todos]\n          const [movedTodo] = newTodos.splice(oldIndex, 1)\n          newTodos.splice(newIndex, 0, movedTodo)\n          return { todos: newTodos }\n        })\n      },\n\n      clearCompleted: () => {\n        set(state => ({\n          todos: state.todos.filter(todo => !todo.completed),\n        }))\n      },\n    }),\n    {\n      name: TODO_STORAGE_KEY,\n      version: 1,\n      partialize: state => ({\n        todos: state.todos,\n        filter: state.filter,\n      }),\n    }\n  )\n)\n\n// ============================================\n// 优化的选择器 Hooks\n// 使用稳定的选择器避免无限循环\n// ============================================\n\n// 稳定的选择器函数\nconst selectTodos = (state: TodoState & TodoActions) => state.todos\nconst selectFilter = (state: TodoState & TodoActions) => state.filter\n\n/**\n * 获取所有待办事项\n */\nexport function useTodos(): Todo[] {\n  return useTodoStore(selectTodos)\n}\n\n/**\n * 获取当前筛选状态\n */\nexport function useFilter(): FilterType {\n  return useTodoStore(selectFilter)\n}\n\n/**\n * 获取统计信息\n */\nexport function useTodoStats(): TodoStats {\n  const todos = useTodoStore(selectTodos)\n  return calculateStats(todos)\n}\n\n/**\n * 获取过滤后的待办事项\n */\nexport function useFilteredTodos(): Todo[] {\n  const todos = useTodoStore(selectTodos)\n  const filter = useTodoStore(selectFilter)\n  return filterTodos(todos, filter)\n}\n\n/**\n * 根据 ID 获取单个待办事项\n */\nexport function useTodoById(id: string): Todo | undefined {\n  const todos = useTodoStore(selectTodos)\n  return todos.find(todo => todo.id === id)\n}\n\n/**\n * 获取优先级统计\n */\nexport function usePriorityStats(): Record<Priority, number> {\n  const todos = useTodoStore(selectTodos)\n  return {\n    high: todos.filter(t => t.priority === 'high').length,\n    medium: todos.filter(t => t.priority === 'medium').length,\n    low: todos.filter(t => t.priority === 'low').length,\n  }\n}\n\n/**\n * 获取完成率\n */\nexport function useCompletionRate(): number {\n  const total = useTodoStore(state => state.todos.length)\n  const completed = useTodoStore(\n    state => state.todos.filter(todo => todo.completed).length\n  )\n  return total > 0 ? Math.round((completed / total) * 100) : 0\n}\n\n// ============================================\n// 导出常量配置\n// ============================================\nexport { PRIORITY_CONFIG }\nexport type { Todo, Priority, FilterType, TodoStats, TodoFormData }\n"],"names":["calculateStats","todos","todo","filterTodos","filter","useTodoStore","create","persist","set","data","now","newTodo","state","id","updates","oldIndex","newIndex","newTodos","movedTodo","TODO_STORAGE_KEY","selectTodos","selectFilter","useTodoStats","useFilteredTodos","useTodoById","usePriorityStats","t","useCompletionRate","total","completed"],"mappings":"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"}