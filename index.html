<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- ç¼“å­˜æ§åˆ¶ -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <title>Levy çš„åˆ›æ„å®éªŒå®¤ ğŸš€</title>
    
    <!-- æ¸…é™¤ç¼“å­˜è„šæœ¬ -->
    <script>
      // ç‰ˆæœ¬å· - æ¯æ¬¡æ„å»ºæ—¶æ›´æ–°
      const BUILD_VERSION = new Date().toISOString().slice(0, 10).replace(/-/g, '');
      const storedVersion = localStorage.getItem('app_version');
      
      // å¦‚æœç‰ˆæœ¬ä¸åŒï¼Œæ¸…é™¤æ‰€æœ‰ç¼“å­˜
      if (storedVersion !== BUILD_VERSION) {
        // æ¸…é™¤ localStorageï¼ˆä¿ç•™ç‰ˆæœ¬å·ï¼‰
        const keys = Object.keys(localStorage);
        keys.forEach(key => {
          if (key !== 'app_version') {
            localStorage.removeItem(key);
          }
        });
        
        // æ¸…é™¤ sessionStorage
        sessionStorage.clear();
        
        // å­˜å‚¨æ–°ç‰ˆæœ¬å·
        localStorage.setItem('app_version', BUILD_VERSION);
        
        // å°è¯•æ¸…é™¤ Service Worker ç¼“å­˜
        if ('caches' in window) {
          caches.keys().then(cacheNames => {
            cacheNames.forEach(cacheName => {
              caches.delete(cacheName);
            });
          });
        }
        
        // æ³¨é”€ Service Worker
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations().then(registrations => {
            registrations.forEach(registration => {
              registration.unregister();
            });
          });
        }
        
        console.log('ç¼“å­˜å·²æ¸…é™¤ï¼Œç‰ˆæœ¬:', BUILD_VERSION);
      }
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
